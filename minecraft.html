<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Minecraft Clone</title>

    <style>
      body {
        margin: 0;
      }

      canvas {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <!-- --- -->
  <body>
    <!-- Scripts -->
    <script src="three.min.js"></script>
    <script src="OrbitControls.js"></script>
    <script src="Stats.js"></script>
    <script src="BufferGeometryUtils.js"></script>

    <script>
      const renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setAnimationLoop(drawFrame);

      document.body.appendChild(renderer.domElement);

      const scene = new THREE.Scene();
      scene.background = new THREE.Color("skyblue");

      const apsect = window.innerWidth / window.innerHeight;

      const camera = new THREE.PerspectiveCamera(30, apsect);
      camera.position.set(0, 10, 0);

      const controls = new THREE.OrbitControls(camera, renderer.domElement);

      controls.enableDamping = true;
      controls.dampingFactor = 0.1;
      controls.maxPolarAngle = Math.PI / 2;
      controls.rotateSpeed = 0.5;

      const stats = new Stats();
      stats.showPanel(0);
      document.body.appendChild(stats.dom);

      const blockGeometry = new THREE.BoxGeometry(1, 1, 1);
      const loader = new THREE.TextureLoader();
      const sandTexture = loader.load("./assets/sand.png");

      const sandMaterial = new THREE.MeshBasicMaterial({
        map: sandTexture,
      });

      const sandBlock = new THREE.Mesh(blockGeometry, sandMaterial);

      scene.add(sandBlock);

      const instancedMesh = new THREE.InstancedMesh(
        blockGeometry,
        sandMaterial,
        40000
      );
      let i = 0;

      for (let x = -100; x < 100; x++) {
        for (let z = -100; z < 100; z++) {
          const matrix = new THREE.Matrix4();
          matrix.setPosition(x, 0, z);

          instancedMesh.setMatrixAt(i, matrix);

          i++;
        }
      }

      scene.add(instancedMesh);

      const light = new THREE.PointLight();
      light.position.set(2, 50, 3);
      scene.add(light);

      const cameraSpeed = 0.1;

      let moveForward = false,
        moveBackward = false,
        moveLeft = false,
        moveRight = false,
        moveUp = false,
        moveDown = false;

      document.addEventListener("keydown", (e) => {
        console.log("keydown", e.key);

        switch (e.key) {
          case "w":
            moveForward = true;
            break;

          case "s":
            moveBackward = true;
            break;

          case "a":
            moveLeft = true;
            break;

          case "d":
            moveRight = true;
            break;

          case "e":
            moveUp = true;
            break;

          case "q":
            moveDown = true;
            break;
        }
      });

      document.addEventListener("keyup", (e) => {
        console.log("Key up", e.key);
        switch (e.key) {
          case "w":
            moveForward = false;
            break;

          case "s":
            moveBackward = false;
            break;

          case "a":
            moveLeft = false;
            break;

          case "d":
            moveRight = false;
            break;

          case "e":
            moveUp = false;
            break;

          case "q":
            moveDown = false;
            break;
        }
      });

      function drawFrame() {
        controls.update();

        const direction = new THREE.Vector3();

        if (moveForward) direction.z -= cameraSpeed;
        if (moveBackward) direction.z += cameraSpeed;
        if (moveLeft) direction.x -= cameraSpeed;
        if (moveRight) direction.x += cameraSpeed;
        if (moveUp) direction.y -= cameraSpeed;
        if (moveDown) direction.y += cameraSpeed;

        camera.position.add(direction);

        stats.begin();
        renderer.render(scene, camera);
        stats.end();
      }
    </script>
  </body>
</html>
